<!DOCTYPE html>
<html>

<head>
    <title>Bus Reservation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="reservation.css" />
</head>

<body>

    <nav class="navbar" style=" z-index: 3; position: fixed;">
        <img src="logo.png" class="navbar-logo" alt="logo" />
        <ul class="navbar-list">
            <li><a href="user_dashboard.php">Home</a></li>
            <li><a href="reservation.html" target="_blank">Reservation</a></li>
            <li><a href="user_dashboard.php">FAQs</a></li>
            <li><a href="user_dashboard.php">Contact</a></li>
        </ul>

        <div class="profile-dropdown">
            <div onclick="toggle()" class="profile-dropdown-btn">
                <div class="profile-img">
                    <i class="fa-solid fa-circle"></i>
                </div>

                <span>Profile
                    <i class="fa-solid fa-angle-down"></i>
                </span>
            </div>

            <ul class="profile-dropdown-list">
                <li class="profile-dropdown-list-item">
                    <a href="#">
                        <i class="fa-regular fa-user"></i>
                        Edit Profile
                    </a>
                </li>

                <li class="profile-dropdown-list-item">
                    <a href="setting.html" target="_blank">
                        <i class="fa-solid fa-sliders"></i>
                        Settings
                    </a>
                </li>

                <li class="profile-dropdown-list-item">
                    <a href="support.html" target="_blank">
                        <i class="fa-regular fa-circle-question"></i>
                        Help & Support
                    </a>
                </li>
                <hr />

                <li class="profile-dropdown-list-item">
                    <a href="login_signup.html">
                        <i class="fa-solid fa-arrow-right-from-bracket"></i>
                        Log out
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="BookedTicketsContainer" style="width: 80%; margin-left: 170px; margin-top: 200px;">
        <div class="ticket" id="reservationDetails">
            <!-- Reservation details will be dynamically loaded here -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            fetchUserReservations();
        });

        function fetchUserReservations() {
            fetch('fetch_user_reservation.php')
                .then(response => response.json())
                .then(reservations => displayReservations(reservations))
                .catch(error => console.error('Error fetching reservations:', error));
        }

        function displayReservations(reservations) {
            var reservationDetails = document.getElementById('reservationDetails');
            reservationDetails.innerHTML = '';

            if (reservations.length > 0) {
                reservations.forEach(function (reservation) {
                    var ticketDiv = document.createElement('div');
                    ticketDiv.classList.add('ticket-info');

                    ticketDiv.innerHTML = `
                <div class="date-time">
                    <p><strong>Name:</strong> ${reservation['BusNumber']}</p>
                    <p><strong>Date:</strong> ${reservation['DepartureDate']}</p>
                    <p><strong>Time:</strong> ${reservation['DepartureTime']}</p>
                </div>
                <div class="from-to">
                    <p><strong>From:</strong> ${reservation['FromLocation']}</p>
                    <p><strong>To:</strong> ${reservation['Destination']}</p>
                </div>
                <div class="bus-details">
                    <p><strong>Bus Number:</strong> ${reservation['BusNumber']}</p>
                    <p><strong>Bus Type:</strong> ${reservation['BusType']}</p>
                </div>
                <div class="bookingdetails">
                    <p><strong>Driver Contact:</strong> ${reservation['ContactNumber']}</p>
                    <p><strong>Number of Seats reserved:</strong> ${reservation['NumberOfSeatsReserved']}</p>
                </div>
                <div class="status">
                    <p><strong>Status:</strong> ${reservation['status']}</p>
                </div>
                <div class="downloadPDF">
                    ${reservation['status'] === 'Approved' ? `<button class="btn" onclick="downloadPDF(${JSON.stringify(reservation)})">Download PDF</button>` : ''}
                </div>
            `;

                    reservationDetails.appendChild(ticketDiv);
                });
            } else {
                reservationDetails.innerHTML = '<p>No reservations found.</p>';
            }
        }

        function downloadPDF(reservation) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.text("Bus Reservation Details", 20, 20);
            doc.text(`Date: ${reservation['DepartureDate']}`, 20, 30);
            doc.text(`Time: ${reservation['DepartureTime']}`, 20, 40);
            doc.text(`From: ${reservation['FromLocation']}`, 20, 50);
            doc.text(`To: ${reservation['Destination']}`, 20, 60);
            doc.text(`Bus Number: ${reservation['BusNumber']}`, 20, 70);
            doc.text(`Bus Type: ${reservation['BusType']}`, 20, 80);
            doc.text(`Driver Contact: ${reservation['ContactNumber']}`, 20, 90);
            doc.text(`Number of Seats: ${reservation['NumberOfSeatsReserved']}`, 20, 100);
            doc.text(`Status: ${reservation['status']}`, 20, 110);

            doc.save("reservation-details.pdf");
        }
    </script>
</body>

</html>